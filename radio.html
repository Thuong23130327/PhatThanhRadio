<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Qu·∫£n l√Ω B√†i Radio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- SheetJS for Excel Export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <style>
    .table-hover tbody tr:hover {
      cursor: pointer;
      background-color: #f1f1f1;
    }
    tr.selected {
      background-color: #d1e7dd !important;
    }
  </style>
</head>
<body class="bg-light py-4">
  <div class="container">
    <h2 class="text-success mb-4">üìª Qu·∫£n l√Ω B√†i Radio</h2>

    <!-- Form nh·∫≠p -->
    <div class="row g-3 mb-3">
      <div class="col-md-4">
        <input type="text" id="chuDe" class="form-control" placeholder="Ch·ªß ƒë·ªÅ">
      </div>
      <div class="col-md-4">
        <input type="text" id="nguoiDoc" class="form-control" placeholder="Ng∆∞·ªùi ƒë·ªçc">
      </div>
      <div class="col-md-3">
        <input type="date" id="ngayPhat" class="form-control">
      </div>
      <div class="col-md-1 d-grid">
        <button onclick="themRadio()" class="btn btn-success">Th√™m</button>
      </div>
    </div>

    <!-- T√¨m ki·∫øm -->
    <div class="row g-3 mb-4 align-items-center">
      <div class="col-md-3">
        <select id="tieuChi" class="form-select">
          <option value="chuDe">Ch·ªß ƒë·ªÅ</option>
          <option value="nguoiDoc">Ng∆∞·ªùi ƒë·ªçc</option>
          <option value="ngayPhat">Ng√†y ph√°t</option>
        </select>
      </div>
      <div class="col-md-6">
        <input type="text" id="tuKhoa" class="form-control" placeholder="Nh·∫≠p t·ª´ kh√≥a ƒë·ªÉ t√¨m...">
      </div>
      <div class="col-md-3 d-flex gap-2">
        <button onclick="timKiem()" class="btn btn-primary">üîç T√¨m</button>
        <button onclick="hienThiTatCa()" class="btn btn-secondary">Hi·ªÉn th·ªã t·∫•t c·∫£</button>
      </div>
    </div>

    <!-- N√∫t thao t√°c -->
    <div class="mb-3 d-flex gap-2">
      <button onclick="xoaDaChon()" class="btn btn-danger">üóëÔ∏è X√≥a ƒë√£ ch·ªçn</button>
      <button onclick="xoaTatCa()" class="btn btn-outline-danger">üßπ X√≥a t·∫•t c·∫£</button>
      <button onclick="xuatExcel()" class="btn btn-outline-success">üìÅ Xu·∫•t file Excel</button>
    </div>

    <!-- B·∫£ng d·ªØ li·ªáu -->
    <div class="table-responsive">
      <table class="table table-bordered table-hover">
        <thead class="table-success text-center">
          <tr>
            <th>Ch·ªß ƒë·ªÅ</th>
            <th>Ng∆∞·ªùi ƒë·ªçc</th>
            <th>Ng√†y ph√°t</th>
          </tr>
        </thead>
        <tbody id="bangRadio"></tbody>
      </table>
    </div>
  </div>

  <script>
    let danhSachRadio = [];
    let indexDangChon = null;

    function themRadio() {
      const chuDe = document.getElementById("chuDe").value.trim();
      const nguoiDoc = document.getElementById("nguoiDoc").value.trim();
      const ngayPhat = document.getElementById("ngayPhat").value;

      if (!chuDe || !nguoiDoc || !ngayPhat) {
        Swal.fire("‚ö†Ô∏è Thi·∫øu th√¥ng tin!", "Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß c√°c tr∆∞·ªùng.", "warning");
        return;
      }

      danhSachRadio.push({ chuDe, nguoiDoc, ngayPhat });
      luuVaoLocalStorage();
      resetForm();
      hienThiTatCa();

      Swal.fire("‚úÖ ƒê√£ th√™m!", "B√†i radio ƒë√£ ƒë∆∞·ª£c th√™m th√†nh c√¥ng.", "success");
    }

    function resetForm() {
      document.getElementById("chuDe").value = "";
      document.getElementById("nguoiDoc").value = "";
      document.getElementById("ngayPhat").value = "";
    }

    function hienThiTatCa() {
      const tbody = document.getElementById("bangRadio");
      tbody.innerHTML = "";

      danhSachRadio.forEach((item, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${item.chuDe}</td>
          <td>${item.nguoiDoc}</td>
          <td>${item.ngayPhat}</td>
        `;
        row.onclick = () => chonDong(row, index);
        if (index === indexDangChon) row.classList.add("selected");
        tbody.appendChild(row);
      });
    }

    function chonDong(row, index) {
      const rows = document.querySelectorAll("#bangRadio tr");
      rows.forEach(r => r.classList.remove("selected"));
      row.classList.add("selected");
      indexDangChon = index;
    }

    function timKiem() {
      const tieuChi = document.getElementById("tieuChi").value;
      const tuKhoa = document.getElementById("tuKhoa").value.trim().toLowerCase();
      const tbody = document.getElementById("bangRadio");
      tbody.innerHTML = "";

      const ketQua = danhSachRadio.filter(item =>
        item[tieuChi].toLowerCase().includes(tuKhoa)
      );

      if (ketQua.length === 0) {
        tbody.innerHTML = "<tr><td colspan='3' class='text-center text-danger'>Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£.</td></tr>";
        return;
      }

      ketQua.forEach((item, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${item.chuDe}</td>
          <td>${item.nguoiDoc}</td>
          <td>${item.ngayPhat}</td>
        `;
        row.onclick = () => chonDong(row, index);
        tbody.appendChild(row);
      });
    }

    function xoaDaChon() {
      if (indexDangChon === null) {
        Swal.fire("‚ö†Ô∏è Ch∆∞a ch·ªçn b√†i!", "Vui l√≤ng ch·ªçn m·ªôt b√†i radio ƒë·ªÉ x√≥a.", "info");
        return;
      }

      Swal.fire({
        title: "B·∫°n c√≥ ch·∫Øc?",
        text: "B√†i radio ƒë√£ ch·ªçn s·∫Ω b·ªã x√≥a.",
        icon: "warning",
        showCancelButton: true,
        confirmButtonText: "X√≥a",
        cancelButtonText: "H·ªßy"
      }).then(result => {
        if (result.isConfirmed) {
          danhSachRadio.splice(indexDangChon, 1);
          indexDangChon = null;
          luuVaoLocalStorage();
          hienThiTatCa();
          Swal.fire("üóëÔ∏è ƒê√£ x√≥a!", "B√†i radio ƒë√£ ƒë∆∞·ª£c x√≥a.", "success");
        }
      });
    }

    function xoaTatCa() {
      Swal.fire({
        title: "B·∫°n c√≥ ch·∫Øc ch·∫Øn?",
        text: "T·∫•t c·∫£ b√†i radio s·∫Ω b·ªã x√≥a.",
        icon: "warning",
        showCancelButton: true,
        confirmButtonText: "X√≥a t·∫•t c·∫£",
        cancelButtonText: "H·ªßy"
      }).then(result => {
        if (result.isConfirmed) {
          danhSachRadio = [];
          indexDangChon = null;
          localStorage.removeItem("dsRadio");
          hienThiTatCa();
          Swal.fire("üßπ ƒê√£ x√≥a h·∫øt!", "T·∫•t c·∫£ b√†i radio ƒë√£ ƒë∆∞·ª£c x√≥a.", "success");
        }
      });
    }

    function xuatExcel() {
      if (danhSachRadio.length === 0) {
        Swal.fire("‚ö†Ô∏è Kh√¥ng c√≥ d·ªØ li·ªáu!", "Danh s√°ch tr·ªëng, kh√¥ng th·ªÉ xu·∫•t file.", "info");
        return;
      }

      const worksheet = XLSX.utils.json_to_sheet(danhSachRadio);
      const workbook = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(workbook, worksheet, "DanhSachRadio");
      XLSX.writeFile(workbook, "DanhSachRadio.xlsx");
    }

    function luuVaoLocalStorage() {
      localStorage.setItem("dsRadio", JSON.stringify(danhSachRadio));
    }

    function docTuLocalStorage() {
      const data = localStorage.getItem("dsRadio");
      if (data) {
        danhSachRadio = JSON.parse(data);
        hienThiTatCa();
      }
    }

    // Load d·ªØ li·ªáu khi m·ªü trang
    docTuLocalStorage();
  </script>
</body>
</html>
